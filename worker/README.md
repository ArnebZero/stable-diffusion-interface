## Воркер

---------

Этот код получает задания от сайта, передает их модели, а результаты возвращает назад.

Ввиду того, что `flask` не поддерживает ассинхронные запросы, у меня мало ресурсов и так как у меня нет возможности слушать какие-либо порты там, где у меня находится модель, было принятно решение отпрвлять с помощью данного воркера запросы к сайту с некоторой периодичностью на получение задания, и когда оно будет получено, отдавать задания модели и возвращать ответ модели назад сайту. В случае если активных заданий нет воркер уходит в недолгий сон перед следующей попыткой получения данных (10 секунд).

Поддерживается прием партии заданий размером не более 3, так как иначе они просто не могут быть нормально переданы по сети из-за размера данных.

Для непрерывной работы используется `tmux` и весь код запускается уже в его сессии.

Для запуска воркера нужно создать виртуальное окружение:

```python3 -m venv venv_worker```

Активировать его

```source venv_worker/bin/activate```

Установить зависимости

```pip install -r requirements.txt```

После чего создать папку `logs`, в нее будет происходить логгирование (высталены параметры по умолчанию, код логгера в файле `logger.py`, логи ротируются по времени каждый час, создается не более 24 файлов).

```mkdir logs```

После чего просто запустить воркер (в `tmux` сессии)

```python3 worker.py```

Для отладки представлен файл `test_server.py`, который эмулирует работу реального сайта, для его запуска в новой сессии `tmux` необходимо запустить файл

```python3 test_server.py```

**Важно!** Для корректной работы файлов в обоих конфигах `server_config.yaml` и `worker_config.yaml` должен быть один и тот же `token`. Сайт будет принимать запросы от воркера только в том случае, если в нем указан верный токен, значение токена можно найти в файле `server.py` в папке `website`. Важно установить надежный токен, так как именно он поддерживает защиту отправки данных, и невозможность подлога вредоносными данными.

Приведенные значения токенов отличаются от указанных на сайте в целях безопасности, поэтому от сайта `arnebzero.ru` ответа не будет.

Воркер желательно разворачивать последним (или хотя бы после модели).

Если мы хотим запусить сервер в тестовом режиме (не в NGINX), то нужно поменять url'ы на сооответственно `http://arnebzero.ru:5000/api/v1/send_task` и `http://arnebzero.ru:5000/api/v1/get_task` (HTTPS протокол не поддерживается в этом случае, и порт не дефолтный)
